record(stringin, "$(P):$(R):InputAddress") {
    field(DESC, "Address del comando da eseguire")
}


record(ao, "$(P):PollingPeriod") {
    field(DESC, "Polling period for all chain")
    field(DTYP, "Soft Channel")
    field(OUT,  "ocemPollingPeriod PP NMS")
    field(PREC, "2")
    field(VAL,  "1.0")
    field(HOPR, "10.0")
    field(LOPR, "0.1")
    field(EGU,  "s")
}

record(ai, "$(P):$(R):IMAX") {
    field(DESC, "Max current for this channel")
    field(DTYP, "Soft Channel")
    field(VAL, "$(IMAX)")
    field(PREC, "1")
    field(EGU, "A")
    field(SCAN, "Passive")
    field(FLNK, "")      # opzionale
}
record(ai, "$(P):$(R):VMAX") {
    field(DESC, "Max Voltage for this channel")
    field(DTYP, "Soft Channel")
    field(VAL, "$(VMAX)")
    field(PREC, "1")
    field(EGU, "A")
    field(SCAN, "Passive")
    field(FLNK, "")      # opzionale
}



record(ai, "$(P):$(R):CurrentNum") {
    field(DTYP, "Soft Channel")
    field(INP, "$(P):$(R):CurrentStr NPP NMS")
    field(SCAN, "Passive")
    field(FLNK, "$(P):$(R):CURRENT_RB")
}


record(calc, "$(P):$(R):CURRENT_RB") {
    field(INPA, "$(P):$(R):CurrentNum NPP NMS")     # valore numerico grezzo
    field(INPB, "$(P):$(R):IMAX NPP NMS")           # valore massimo
    field(INPC, "$(P):$(R):CURRENT_PRG_MAX NPP NMS")    # fattore di scala
    field(CALC, "(A*B)/C")                      # esempio formula
    field(PREC, "4")                                # 4 decimali di precisione
    field(SCAN, "Passive")                         # si aggiorna automaticamente
    field(EGU,  "A")                                # unità di misura
}

record(calc, "$(P):$(R):VOLTAGE_RB") {
    field(INPA, "$(P):$(R):VoltageStr NPP NMS")     # valore numerico grezzo
    field(INPB, "$(P):$(R):VMAX NPP NMS")           # valore massimo
    field(INPC, "$(P):$(R):VOLTAGE_PRG_MAX NPP NMS")    # fattore di scala
    field(CALC, "(A*B)/C")                      # esempio formula
    field(PREC, "4")                                # 4 decimali di precisione
    field(SCAN, "Passive")                         # si aggiorna automaticamente
    field(EGU,  "A")                                # unità di misura
}



record(stringin, "$(P):$(R):Status") {
    field(DESC, "Legge lo stato")
    field(DTYP, "OCEME642")
    field(INP,  "@$(ADDR) STA")
    field(SCAN, "I/O Intr")
}
record(stringin, "$(P):$(R):CurrentStr") {
    field(DESC, "Legge la corrente")
    field(DTYP, "OCEME642")
    field(INP,  "@$(ADDR) COR")
    field(SCAN, "I/O Intr")
    field(FLNK, "$(P):$(R):CurrentNum")
}

record(stringin, "$(P):$(R):VoltageStr") {
    field(DESC, "Legge la tensione")
    field(DTYP, "OCEME642")
    field(INP,  "@$(ADDR) TEN")
    field(SCAN, "I/O Intr")
    field(FLNK, "$(P):$(R):VOLTAGE_RB")
}

record(stringin, "$(P):$(R):Polarity") {
    field(DESC, "Legge la polarità")
    field(DTYP, "OCEME642")
    field(INP,  "@$(ADDR) POL")
    field(SCAN, "I/O Intr")
}
record(stringin, "$(P):$(R):Alarms") {
    field(DESC, "Legge gli allarmi")
    field(DTYP, "OCEME642")
    field(INP,  "@$(ADDR) ALL")
    field(SCAN, "I/O Intr")
}

record(stringin, "$(P):$(R):SELECTOR") {
    field(DESC, " LOCAL or REMOTE")
    field(DTYP, "OCEME642")
    field(INP,  "@$(ADDR) SEL")    # indirizzo + eventuale parametro
    field(SCAN, "I/O Intr")
}

record(stringin, "$(P):$(R):CURRENT_PRG_MAX") {
    field(DESC, " Max Current set digit")
    field(DTYP, "OCEME642")
    field(INP,  "@$(ADDR) INI_CURMAX")    # indirizzo + eventuale parametro
    field(SCAN, "I/O Intr")
}
record(stringin, "$(P):$(R):CURRENT_PRG_MIN") {
    field(DESC, " Min Current set digit")
    field(DTYP, "OCEME642")
    field(INP,  "@$(ADDR) INI_CURMIN")    # indirizzo + eventuale parametro
    field(SCAN, "I/O Intr")
}
record(stringin, "$(P):$(R):VOLTAGE_PRG_MAX") {
    field(DESC, " Max Voltage set digit")
    field(DTYP, "OCEME642")
    field(INP,  "@$(ADDR) INI_VOLMAX")    # indirizzo + eventuale parametro
    field(SCAN, "I/O Intr")
}
record(stringin, "$(P):$(R):VOLTAGE_PRG_MIN") {
    field(DESC, " Min Voltage set digit")
    field(DTYP, "OCEME642")
    field(INP,  "@$(ADDR) INI_VOLMIN")    # indirizzo + eventuale parametro
    field(SCAN, "I/O Intr")
}

record(stringin, "$(P):$(R):UNIMAGSTATUS") {
    field(DESC, " Status converted to unimag standard")
    field(DTYP, "OCEME642")
    field(INP,  "@$(ADDR) UNIMAG")    # indirizzo + eventuale parametro
    field(SCAN, "I/O Intr")
    field(FLNK, "$(P):$(R):STATE_RB")
}

record(mbbi, "$(P):$(R):STATE_RB") {
    field(DESC, "State readback")
    field(INP,  "$(P):$(R):UNIMAGSTATUS NPP NMS")
    field(SCAN, "Passive") 
    field(ZRVL, "0")
    field(ZRST, "OFF")
    field(ONVL, "1")
    field(ONST, "ON")
    field(TWVL, "2")
    field(TWST, "STANDBY")
    field(THVL, "3")
    field(THST, "RESET")
    field(FRVL, "4")
    field(FRST, "INTERLOCK")
    field(FRSV, "MAJOR") 
    field(FVVL, "5")
    field(FVST, "ERROR")
    field(FVSV, "MAJOR")
}


record(stringout, "$(P):$(R):SetON") {
    field(DTYP, "OCEME642")
    field(OUT,  "@$(ADDR) ON")    # indirizzo + eventuale parametro
    field(VAL,  "ON")        # valore di default
}
record(stringout, "$(P):$(R):SetSTANDBY") {
    field(DTYP, "OCEME642")
    field(OUT,  "@$(ADDR) STB")    # indirizzo + eventuale parametro
    field(VAL,  "STB")        # valore di default
}

record(stringout, "$(P):$(R):SetPolarity") {
    field(DESC, "values: \"POS\" , \"OPN\",\"NEG\"")
    field(DTYP, "OCEME642")
    field(OUT,  "@$(ADDR) setPOL")    # indirizzo + eventuale parametro
    
}
record(stringout, "$(P):$(R):STATUS_SP") {
    field(DESC, "Set Status, values: \"STB\" e \"ON\"")
    field(DTYP, "OCEME642")
    field(OUT,  "@$(ADDR) setSTA")    # indirizzo + eventuale parametro
    
}
record(stringout, "$(P):$(R):SETCURRENT_RAW") {
    field(DTYP, "OCEME642")
    field(OUT,  "@$(ADDR) SP")    # indirizzo + eventuale parametro
    #field(VAL,  "STB")        # valore di default
    field(OMSL, "closed_loop")             # prende valore da DOL
    field(DOL, "$(P):$(R):AmpToDigitFormat.VAL NPP NMS")
    
}

record(ao, "$(P):$(R):SETCURRENT") {
    field(DESC, "Set current in Ampere")
    field(EGU,  "A")
    field(PREC, "3")
    field(SCAN, "Passive")
    field(FLNK, "$(P):$(R):AmpToDigit")
}

record(calc, "$(P):$(R):AmpToDigit") {
    field(DESC, "Convert Ampere → Digit")
    field(INPA, "$(P):$(R):SETCURRENT NPP NMS")   # Ampere impostati
    field(INPB, "$(P):$(R):IMAX NPP NMS")         # Corrente massima
    field(INPC, "$(P):$(R):CURRENT_PRG_MAX NPP NMS")       # Program range massimo
    field(CALC, "A*C/B")                          # Digit = Ampere*IMAX/MAXPRG
    field(SCAN, "Passive")
    field(FLNK, "$(P):$(R):AmpToDigitFormat")
}

record(calcout, "$(P):$(R):AmpToDigitFormat") {
    field(INPA, "$(P):$(R):AmpToDigit.VAL NPP NMS")
    field(CALC, "NINT(A)")
    field(OUT,  "$(P):$(R):SETCURRENT_RAW.VAL PP")
    field(SCAN, "Passive")
}

record(stringout, "$(P):$(R):Start_ramp") {
    field(DTYP, "OCEME642")
    field(OUT,  "@$(ADDR) STR")    # indirizzo + eventuale parametro
    field(VAL,  "STR")        # valore di default
}
record(stringout, "$(P):$(R):RESET_ALARMS") {
    field(DTYP, "OCEME642")
    field(OUT,  "@$(ADDR) RES")    # indirizzo + eventuale parametro
    field(VAL,  "RES")        # valore di default
}
record(stringout, "$(P):$(R):PROGRAMDATA_RB") {
    field(DTYP, "OCEME642")
    field(OUT,  "@$(ADDR) PRG")    # indirizzo + eventuale parametro
    field(VAL,  "PRG S")        # valore di default
}
